# convert-genotype



## 概述

该脚本用于将 VCF 格式的基因型数据（如 `0/1`、`1/1` 等）转换为实际的碱基表示（如 `A/T`、`G/G` 等）。脚本会读取输入文件，根据参考碱基（REF）和变异碱基（ALT）列的信息，将样本的基因型转换为碱基型，并将结果保存到输出文件中。

---

## 输入文件格式

输入文件应为制表符分隔的文本文件，格式如下：

| CHROM | POS  | REF | ALT  | KM1502 | KM1706 | PY9  | X2016 |
|-------|------|-----|------|--------|--------|------|-------|
| 1A    | 545517 | G   | T    | 0/0    | 0/1    | 1/1  | ./.   |
| 1A    | 545545 | T   | A    | 0/0    | 0/0    | 1/1  | ./.   |
| 1A    | 4748766 | T   | A,G  | 0/0    | 1/2    | ./.  | 0/0   |

- **CHROM**：染色体名称。
- **POS**：位点位置。
- **REF**：参考碱基。
- **ALT**：变异碱基（可以是单个碱基或多个碱基，用逗号分隔）。
- **KM1502, KM1706, PY9, X2016**：样本的基因型数据，格式为 `0/0`、`0/1`、`1/1` 或 `./.`（缺失数据）。

---

## 输出文件格式

脚本会生成一个新的文件，格式与输入文件类似，但会为每个样本的基因型列添加一列对应的碱基型列（以 `_GT` 结尾）：

| CHROM | POS  | REF | ALT  | KM1502 | KM1502_GT | KM1706 | KM1706_GT | PY9  | PY9_GT | X2016 | X2016_GT |
|-------|------|-----|------|--------|-----------|--------|-----------|------|--------|-------|----------|
| 1A    | 545517 | G   | T    | 0/0    | G/G       | 0/1    | G/T       | 1/1  | T/T    | ./.   | ./.      |
| 1A    | 545545 | T   | A    | 0/0    | T/T       | 0/0    | T/T       | 1/1  | A/A    | ./.   | ./.      |
| 1A    | 4748766 | T   | A,G  | 0/0    | T/T       | 1/2    | A/G       | ./.  | ./.    | 0/0   | T/T      |

---

## 脚本功能

1. **基因型转换**：
   - 将 `0/0` 转换为 `REF/REF`。
   - 将 `0/1` 转换为 `REF/ALT`。
   - 将 `1/1` 转换为 `ALT/ALT`。
   - 如果 ALT 列有多个值（如 `A,G`），基因型 `1/2` 会被转换为 `A/G`。
   - 缺失数据（`./.`）会保留为 `./.`。

2. **处理多等位基因**：
   - 如果 ALT 列包含多个碱基（如 `A,G`），脚本会根据基因型正确转换。

3. **错误处理**：
   - 如果基因型超出 ALT 列的范围（如 ALT 只有 1 个值但基因型为 `2`），会用 `?` 标记。

---

## 使用方法

### 1. 在 Jupyter Notebook 中运行

将脚本代码复制到 Jupyter Notebook 的一个代码单元格中，然后运行以下代码：

```python
# 设置输入文件和输出文件路径
input_file = 'input.txt'  # 输入文件名
output_file = 'output.txt'  # 输出文件名

# 运行脚本
process_file(input_file, output_file)
print(f"处理完成！结果已保存到 {output_file}")
```

### 2. 在命令行中运行

将脚本保存为 `convert_genotypes.py`，然后在命令行中运行：

```bash
python convert_genotypes.py input.txt output.txt
```

- `input.txt`：输入文件名。
- `output.txt`：输出文件名。

---

## 示例

### 输入文件 (`input.txt`)

```
CHROM	POS	REF	ALT	KM1502	KM1706	PY9	X2016
1A	545517	G	T	0/0	0/1	1/1	./.
1A	545545	T	A	0/0	0/0	1/1	./.
1A	4748766	T	A,G	0/0	1/2	./.	0/0
```

### 输出文件 (`output.txt`)

```
CHROM	POS	REF	ALT	KM1502	KM1502_GT	KM1706	KM1706_GT	PY9	PY9_GT	X2016	X2016_GT
1A	545517	G	T	0/0	G/G	0/1	G/T	1/1	T/T	./.	./.
1A	545545	T	A	0/0	T/T	0/0	T/T	1/1	A/A	./.	./.
1A	4748766	T	A,G	0/0	T/T	1/2	A/G	./.	./.	0/0	T/T
```


---

## 许可证

本项目采用 [MIT 许可证](https://opensource.org/licenses/MIT)。
